<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="images/nrt-logo.svg" type="image/x-icon" />
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,400&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <script src="js/jquery-3.6.0.min.js"></script>
    <!-- <script src="js/bootstrap.min.js"></script>    -->
    <link rel="stylesheet" href="css/style.css">
    <script src="js/linked.js"></script>


    <title>Project Plan Budget Sanction</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular.min.js"></script>
    <style>
        .flexbox .dropdd {width: 100%;}
        .s2 {width: 20%;}
    </style>
</head>

<body  ng-controller="contr">
    <header class="topheading">
        <div class="logo">
            <img src="images/nrt-logo.svg" alt="" />
        </div>
        <a class="btn bluebtn" ng-click="goBack()">Back</a>
        <a class="userlogin" ng-click="logout()">{{details.name}} <span><img src="https://exam.skmu.ac.in/ftpwebapps/skmu/resources/studentdata/users/profileimage/{{details.profile_image}}" alt="student" /></span></a>
          

    </header>
    <section class="formsec">
        <div class="titles">{{subbreadcrumb}}</div>Project Plan Budget Sanction</div>
        <!-- <div class="titles">{{subbreadcrumb}}</div>Gl Group Master</div> -->
        <form name="myform" ng-submit="save()">
            <div class="container notop white-box">
                <ul class="flexbox" style="flex-wrap: wrap; gap:15px;">
                    <li class="s2">
                        <div class="">
                            <label for="sanctionId">Sanction Id</label>
                            <input type="text" class="textfield uppercase" ng-model="form.sanctionId"
                                id="sanctionId" placeholder="Sanction Id" ng-disabled="flag" maxlength="5"
                                required>
                        </div>
                    </li>
                    <li class="width30">
                        <div>
                            <label for="planNo">Plan No</label>
                            <select ng-model="form.planNo" class="dropdd" required>
                                <option value="" disabled selected> Select </option>
                                <option ng-repeat="x in ProjectPlan" value="{{x.planNo}}">{{x.planNo}}
                                   
                                </option>
                            </select>
                        </div>

                    </li>

                    <li>

                        <label for="planFinYear">Plan Fin Year</label>
                        <select ng-model="form.planFinYear" class="dropdd" required>
                            <option value="" disabled selected> Select Plan Fin Year</option>
                            <option ng-repeat="x in ProjectPlan" value="{{x.planFinYear}}">{{x.planFinYear}}
                            </option>
                        </select>

                    </li>
                    <li>

                        <label for="planTypeCode">Plan Type Code</label>
                        <select ng-model="form.planTypeCode" class="dropdd" required>
                            <option value="" disabled selected> Select </option>
                            <option ng-repeat="x in ProjectPlan" value="{{x.planTypeCode}}">{{x.planTypeCode}} 
                                
                            </option>
                        </select>

                    </li>
                    <li>
                        <div>
                          <label>Sanction Date<sup>*</sup></label>
                          <input type="text" class="textfield datepicker" autocomplete="off" name="sanctionDate" value="" placeholder="Sanction Date"
                            ng-model="form.sanctionDate" required />
                        </div>
                      </li>
                      <li>
                        <div>
                          <label>Sanction Fin Year<sup>*</sup></label>
                          <input type="text" class="textfield" name="sanctionFinYear" value="" placeholder="Sanction Fin Year"
                            ng-model="form.sanctionFinYear" required />
                        </div>
                      </li>
                      <li>
                        <div>
          
                          <label>Sanction Reference<sup>*</sup></label>
                          <input type="text" class="textfield" name="sanctionRef" value="" placeholder="Plan Reference"
                            ng-model="form.sanctionRef" required />
                        </div>
                      </li>
                      <li>
                        <div>
                          <label>Sanction Ref. Date<sup>*</sup></label>
                          <input type="text" class="textfield datepicker " autocomplete="off" name="sanctionRefDate" value=""
                            placeholder="Sanction Ref. Date" ng-model="form.sanctionRefDate" required />
                        </div>
                      </li>
                      <li>
                        <div>
                          <label>Sanction Total Budget</label>
                          <input type="text" class="textfield " name="sanctionTotalBudget" only-numbers value="" placeholder="Sanction Total Budget"
                            ng-model="form.sanctionTotalBudget" />
                        </div>
                      </li>
                      <li>
                        <div>
                          <label>Sanction Capital Budget<sup>*</sup></label>
                          <input type="text" class="textfield " name="sanctionCapitalBudget" only-numbers value="" placeholder="Sanction Capital Budget"
                            ng-model="form.sanctionCapitalBudget" required />
                        </div>
                      </li>
                      <li>
                        <div>
                          <label>Sanction Revenue Budget<sup>*</sup></label>
                          <input type="text" class="textfield " name="sanctionRevenueBudget" only-numbers value="" placeholder="Sanction Revenue Budget"
                            ng-model="form.sanctionRevenueBudget" required />
                        </div>
                      </li>

                    <li>
                        <div>
                            <button type="submit" class="bluebtn " style="margin-top: 25px;">Save</button>
                        </div>
                    </li>


                </ul>
            </div>
        </form>
        <div class="white-box">

            <table class="table table-bordered text-center regtable table-condensed">
                <thead>
                    <tr>
                        <th style="text-align: center;" width="80">Sanction Id</th>
                        <th width="120">Plan No</th>
                        <th width="80">Plan Fin Year</th>
                        <th width="80">Plan Type Code</th>
                        <th width="80">Sanction Date</th>
                        <th width="80">Sanction Fin Year</th>
                        <th width="80">Sanction Reference</th>
                        <th width="80">Sanction Ref. Date</th>
                        <th width="80">Sanction Total Budget</th>
                        <th width="80">Sanction Capital Budget </th>
                        <th width="80">Sanction Capital Budget </th>
                        <th width="100">Action </th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="n in data" class="tdcolor">
                        <td ng-bind="n.sanctionId | uppercase" ng-disabled="flag"> </td>
                        <td ng-bind="n.planNo"></td>
                        <td ng-bind="n.planFinYear"></td>
                        <td ng-bind="n.planTypeCode"></td>
                        <td ng-bind="n.sanctionDate"> </td>
                        <td ng-bind="n.sanctionFinYear"> </td>
                        <td ng-bind="n.sanctionRef"></td>
                        <td ng-bind="n.sanctionRefDate"> </td>
                        <td ng-bind="n.sanctionTotalBudget"></td>
                        <td ng-bind="n.sanctionCapitalBudget"> </td>
                        <td ng-bind="n.sanctionRevenueBudget"> </td>
                        <td><button type="button" class="bluebtn" ng-click="edit(n)">Edit</button>
                        </td>
                    </tr>
                    <tr></tr>
                </tbody>
            </table>

        </div>

    </section>
    <footer class="footerbg footerdown">
        Â© 2023 All Rights Reserved.
    </footer>
    <link rel='stylesheet' type='text/css' href='css/bootstrap-datepicker.min.css'>
    <script type='text/javascript' src='js/bootstrap-datepicker.min.js'></script>
    <script type="text/javascript">
      $('.datepicker').datepicker({
        format: "yyyy-MM-dd",
        startDate: new Date('1900-7-15'),
        endDate: new Date('3022-8-15')
      }); 
    </script>
  
    <script>
        

        app.controller('contr', function ($scope, $http, $timeout, $window, $rootScope, $filter) {
            $scope.form = {};
            $scope.flag = false;

            $scope.details=[];
            var token;
            const userDetailsJSON = $window.sessionStorage.getItem('userDetails');
            if (userDetailsJSON) {
            const userDetails = JSON.parse(userDetailsJSON);
            if (userDetails.token!=null || userDetails.token!=''){
                $scope.details=angular.copy(userDetails);
                token=$scope.details.token;
            }
            } else {
            $window.location.href = "index.html";
            console.log('User details not found in sessionStorage');
            }
            $scope.logout = function() {
            $window.sessionStorage.removeItem('userDetails');
            $window.location.href = 'index.html';
            };

            var config = {
            headers: {
           'Authorization': 'Bearer ' + token
               },   
            };

            // saving data to Project Plan Budget Sanction table 
            $scope.save = function () {
                console.log($scope.form);
                $http.post(path+"/api/v1/account/projectPlanSanction/data", $scope.form,config)
                    .then(function successCallback(response) {
                        $scope.form = {};
                        $scope.getdata()
                    },
                        function errorCallback(response) {
                            console.log("saving of data failed");
                        });
            }

            //Fetching of data from bankaccount table 
            $scope.getdata = function () {
                $http.get(path+"/api/v1/account/projectPlanSanction/alldata",config)
                    .then(function successCallback(response) {
                        $scope.data = response.data;
                        console.log($scope.data)
                    },
                        function errorCallback(response) {
                            console.log("saving of data failed");
                        });

            }
            $scope.getdata();


            // Fetching data from bank table 
            $scope.ProjectPlan = [];
            $scope.getProjectPlan = function () {
                $http.get(path+"/api/v1/account/projectPlan/alldata",config)
                    .then(function successCallback(response) {
                        $scope.ProjectPlan = response.data;
                        console.log("Data 2", $scope.ProjectPlan)
                    },
                        function errorCallback(response) {
                            console.log("Fetching of data failed from Project Plan table ");
                        });


            }
            $scope.getProjectPlan();

            
            // To edit the data 
            $scope.edit = function edit(n) {
                $scope.flag = true;

                console.log($scope.form)
                $scope.form = {
                    sanctionId: n.sanctionId,
                    planNo: n.planNo.toString(),
                    planFinYear: n.planFinYear.toString(),
                    planTypeCode: n.planTypeCode.toString(),
                    sanctionDate: n.sanctionDate,
                    sanctionFinYear: n.sanctionFinYear,
                    sanctionRef: n.sanctionRef,
                    sanctionRefDate: n.sanctionRefDate,
                    sanctionTotalBudget: n.sanctionTotalBudget,
                    sanctionCapitalBudget: n.sanctionCapitalBudget,
                    sanctionRevenueBudget: n.sanctionRevenueBudget,
                }
                 console.log($scope.form)

            };


            //To update the data and save the data back to the table 
            $scope.update = function () {

                var data = $scope.form;
                var sl = data.sanctionId;
                var url = path+'/api/v1/account/projectPlanSanction/data' + sl;
                $http.put(url, data,config)
                    .then(function successCallback(response) {

                        $scope.getdata()
                        $scope.form = {};

                    },
                        function errorCallback(response) {
                            console.log("updating of data failed  ");
                        });
            }
                            $scope.goBack = function () {
                            window.history.back();
                        }

        })

    </script>
</body>

</html>